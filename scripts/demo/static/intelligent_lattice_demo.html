<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ODRAS Intelligent Project Lattice Generator</title>
    <script src="https://unpkg.com/cytoscape@3.28.1/dist/cytoscape.min.js"></script>
    <link rel="stylesheet" href="lattice_demo.css">
    <style>
        /* Override main layout for better scrolling */
        .main-layout {
            flex: 1;
            display: flex;
            height: calc(100vh - 340px); /* Account for requirements panel */
            min-height: 500px;
        }
        
        .left-panel, .right-panel {
            width: 280px;
            background: var(--dark-2);
            border-right: 1px solid var(--border-dark);
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: 100%;
        }
        
        .right-panel {
            border-right: none;
            border-left: 1px solid var(--border-dark);
        }
        
        .requirements-panel {
            background: var(--dark-2);
            border: 1px solid var(--border-dark);
            border-radius: 8px;
            padding: 20px;
            margin: 0 20px 20px 20px;
            max-height: 280px;
            overflow-y: auto;
        }
        
        .requirements-input {
            width: 100%;
            height: 150px; /* Fixed height instead of min-height */
            background: var(--dark-3);
            border: 1px solid var(--border-dark);
            border-radius: 4px;
            padding: 12px;
            color: var(--light);
            font-family: monospace;
            font-size: 0.9rem;
            resize: none; /* Disable resize to control layout */
        }
        
        .requirements-controls {
            display: flex;
            gap: 12px;
            margin-top: 12px;
            align-items: center;
        }
        
        .file-input {
            display: none;
        }
        
        .btn-file {
            background: var(--dark-3);
            border: 1px solid var(--border-dark);
            color: var(--light);
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .btn-file:hover {
            background: var(--border-dark);
        }
        
        .generate-btn {
            background: var(--success);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .generate-btn:hover {
            background: #059669;
        }
        
        .generate-btn:disabled {
            background: var(--text-light);
            cursor: not-allowed;
        }
        
        .analysis-status {
            margin-left: auto;
            color: var(--warning);
            font-style: italic;
        }
        
        .lattice-header {
            background: var(--dark-2);
            border-bottom: 1px solid var(--border-dark);
            padding: 12px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .analysis-summary {
            background: var(--dark-3);
            border: 1px solid var(--border-dark);
            border-radius: 4px;
            padding: 12px;
            margin: 12px 0;
            font-size: 0.9rem;
            color: var(--light);
        }
        
        .confidence-badge {
            display: inline-block;
            background: var(--success);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        /* Canvas legend positioning */
        .canvas-legend {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid var(--border-dark);
            border-radius: 8px;
            padding: 12px;
            font-size: 0.8rem;
            z-index: 10;
            backdrop-filter: blur(5px);
        }
        
        .canvas-legend h4 {
            color: var(--primary);
            margin: 0 0 8px 0;
            font-size: 0.9rem;
        }
        
        .canvas-legend .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 4px;
            font-size: 0.75rem;
        }
        
        .canvas-legend .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px;
        }
        
        .canvas-legend .legend-line {
            width: 16px;
            height: 2px;
            border-radius: 1px;
        }
        
        .canvas-legend .legend-divider {
            height: 1px;
            background: var(--border-dark);
            margin: 6px 0;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <h1>üß† ODRAS Intelligent Project Lattice Generator</h1>
            <div class="header-controls">
                <button class="btn" id="showDebugBtn" style="display: none;">üîç Show LLM Context</button>
                <div class="connection-status" id="connectionStatus">
                    <span class="status-indicator" id="statusIndicator">‚óè</span>
                    <span id="statusText">Ready</span>
                </div>
            </div>
        </header>

        <!-- Requirements Input Panel -->
        <div class="requirements-panel">
            <h3>üìã Requirements Input</h3>
            <p>Upload or paste UAV acquisition requirements. The LLM will analyze and generate an intelligent project lattice.</p>
            
            <textarea 
                id="requirementsInput" 
                class="requirements-input"
                placeholder="Paste UAV acquisition requirements here...&#10;&#10;Example:&#10;# UAV Mission Requirements&#10;The system shall provide surveillance capability...&#10;The UAV shall operate for minimum 4 hours...&#10;The system shall support multiple sensor packages..."
            ></textarea>
            
            <div class="requirements-controls">
                <label class="btn-file" for="requirementsFile">
                    üìÅ Load Requirements File
                    <input type="file" id="requirementsFile" class="file-input" accept=".md,.txt">
                </label>
                
                <button id="loadExampleBtn" class="btn">Load Example</button>
                
                <button id="generateLatticeBtn" class="generate-btn">
                    üß† Generate Intelligent Lattice
                </button>
                
                <div class="analysis-status" id="analysisStatus"></div>
            </div>
            
            <div id="analysisSummary" class="analysis-summary" style="display: none;">
                <!-- LLM analysis summary will appear here -->
            </div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Left Panel - Project Details -->
            <div class="left-panel">
                <div class="panel-section">
                    <h3>Generated Projects</h3>
                    <div class="project-list" id="projectList">
                        <div class="no-projects">No projects generated yet...</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Data Flows</h3>
                    <div class="data-flows" id="dataFlows">
                        <div class="no-flows">No data flows defined yet...</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Controls</h3>
                    <div class="controls">
                        <button class="btn-small" id="activateProjectsBtn" disabled>Start Processing</button>
                        <button class="btn-small" id="stepThroughBtn" disabled>Step Through</button>
                        <button class="btn-small" id="resetBtn">Reset</button>
                    </div>
                </div>
            </div>

            <!-- Center Panel - Visualization -->
            <div class="center-panel">
                <div class="lattice-header">
                    <div class="lattice-info">
                        <span>Projects: <span id="projectCount">0</span></span>
                        <span>Data Flows: <span id="flowCount">0</span></span>
                    </div>
                    <div class="lattice-confidence" id="latticeConfidence" style="display: none;">
                        <!-- Confidence badge will appear here -->
                    </div>
                </div>
                
                <div class="visualization-header">
                    <div class="layer-labels">
                        <div class="layer-label" data-layer="0">L0</div>
                        <div class="layer-label" data-layer="1">L1</div>
                        <div class="layer-label" data-layer="2">L2</div>
                        <div class="layer-label" data-layer="3">L3</div>
                    </div>
                    <div class="domain-labels" id="domainLabels">
                        <!-- Domain labels will be added dynamically -->
                    </div>
                </div>
                
                <div class="graph-container">
                    <div id="cy" class="cytoscape-container"></div>
                    
                    <!-- Legend positioned in canvas corner -->
                    <div class="canvas-legend">
                        <h4>Legend</h4>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #3b82f6;"></div>
                            <span>L0 Foundation</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #10b981;"></div>
                            <span>L1 Strategic</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #f59e0b;"></div>
                            <span>L2 Tactical</span>
                        </div>
                        <div class="legend-item">
                            <div class="legend-color" style="background: #ef4444;"></div>
                            <span>L3 Concrete</span>
                        </div>
                        <div class="legend-divider"></div>
                        <div class="legend-item">
                            <div class="legend-line" style="background: #60a5fa; height: 2px;"></div>
                            <span>Data Flow</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Right Panel - Processing Details -->
            <div class="right-panel">
                <div class="panel-section">
                    <h3>Processing Status</h3>
                    <div class="processing-status" id="processingStatus">
                        <div class="no-processing">No processing active...</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Current Data</h3>
                    <div class="current-data" id="currentData">
                        <div class="no-data">No data flowing yet...</div>
                    </div>
                </div>

                <div class="panel-section">
                    <h3>Results</h3>
                    <div class="results" id="results">
                        <div class="no-results">No results yet...</div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script src="intelligent_lattice.js"></script>
</body>
</html>
