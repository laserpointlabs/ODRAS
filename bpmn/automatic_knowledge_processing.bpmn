<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" id="Definitions_AutoKnowledge" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="5.34.0">
  <bpmn:process id="automatic_knowledge_processing" name="Automatic Knowledge Processing" isExecutable="true" camunda:historyTimeToLive="30">
    <bpmn:startEvent id="StartEvent_FileUploaded" name="File Uploaded">
      <bpmn:outgoing>Flow_ToTextExtraction</bpmn:outgoing>
    </bpmn:startEvent>
    
    <bpmn:serviceTask id="Task_ExtractText" name="Extract Text Content" camunda:type="external" camunda:topic="extract-text">
      <bpmn:documentation>
        Extract text content from uploaded file.
        Support multiple formats: PDF, DOC, TXT, MD, etc.
        Preserve document structure and metadata.
      </bpmn:documentation>
      <bpmn:incoming>Flow_ToTextExtraction</bpmn:incoming>
      <bpmn:outgoing>Flow_ToChunking</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:serviceTask id="Task_ChunkDocument" name="Chunk Document Content" camunda:type="external" camunda:topic="chunk-document">
      <bpmn:documentation>
        Intelligently chunk document content using detected strategy.
        Apply semantic, hybrid, or fixed chunking based on document type.
        Preserve context and maintain readability.
      </bpmn:documentation>
      <bpmn:incoming>Flow_ToChunking</bpmn:incoming>
      <bpmn:outgoing>Flow_ToEmbeddings</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:serviceTask id="Task_GenerateEmbeddings" name="Generate Vector Embeddings" camunda:type="external" camunda:topic="generate-embeddings">
      <bpmn:documentation>
        Generate vector embeddings for document chunks.
        Use specified embedding model (default: all-MiniLM-L6-v2).
        Create searchable vector representations.
      </bpmn:documentation>
      <bpmn:incoming>Flow_ToEmbeddings</bpmn:incoming>
      <bpmn:outgoing>Flow_ToKnowledgeAsset</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:serviceTask id="Task_CreateKnowledgeAsset" name="Create Knowledge Asset" camunda:type="external" camunda:topic="create-knowledge-asset">
      <bpmn:documentation>
        Create knowledge asset record in PostgreSQL.
        Store metadata, processing stats, and asset information.
        Link to source file and project context.
      </bpmn:documentation>
      <bpmn:incoming>Flow_ToKnowledgeAsset</bpmn:incoming>
      <bpmn:outgoing>Flow_ToVectorStorage</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:serviceTask id="Task_StoreVectorChunks" name="Store Vector Chunks" camunda:type="external" camunda:topic="store-vector-chunks">
      <bpmn:documentation>
        Store chunk embeddings in Qdrant vector database.
        Create searchable index with metadata payload.
        Enable semantic similarity search and retrieval.
      </bpmn:documentation>
      <bpmn:incoming>Flow_ToVectorStorage</bpmn:incoming>
      <bpmn:outgoing>Flow_ToActivation</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:serviceTask id="Task_ActivateKnowledgeAsset" name="Activate Knowledge Asset" camunda:type="external" camunda:topic="activate-knowledge-asset">
      <bpmn:documentation>
        Update knowledge asset status from 'processing' to 'active'.
        Makes the asset visible in the UI and available for RAG queries.
        Final step of the knowledge processing pipeline.
      </bpmn:documentation>
      <bpmn:incoming>Flow_ToActivation</bpmn:incoming>
      <bpmn:outgoing>Flow_ToCompletion</bpmn:outgoing>
    </bpmn:serviceTask>
    
    <bpmn:endEvent id="EndEvent_KnowledgeReady" name="Knowledge Asset Ready">
      <bpmn:incoming>Flow_ToCompletion</bpmn:incoming>
    </bpmn:endEvent>
    
    <!-- Sequence Flows -->
    <bpmn:sequenceFlow id="Flow_ToTextExtraction" sourceRef="StartEvent_FileUploaded" targetRef="Task_ExtractText" />
    <bpmn:sequenceFlow id="Flow_ToChunking" sourceRef="Task_ExtractText" targetRef="Task_ChunkDocument" />
    <bpmn:sequenceFlow id="Flow_ToEmbeddings" sourceRef="Task_ChunkDocument" targetRef="Task_GenerateEmbeddings" />
    <bpmn:sequenceFlow id="Flow_ToKnowledgeAsset" sourceRef="Task_GenerateEmbeddings" targetRef="Task_CreateKnowledgeAsset" />
    <bpmn:sequenceFlow id="Flow_ToVectorStorage" sourceRef="Task_CreateKnowledgeAsset" targetRef="Task_StoreVectorChunks" />
    <bpmn:sequenceFlow id="Flow_ToActivation" sourceRef="Task_StoreVectorChunks" targetRef="Task_ActivateKnowledgeAsset" />
    <bpmn:sequenceFlow id="Flow_ToCompletion" sourceRef="Task_ActivateKnowledgeAsset" targetRef="EndEvent_KnowledgeReady" />
  </bpmn:process>
  
  <!-- BPMN Diagram Information -->
  <bpmndi:BPMNDiagram id="BPMNDiagram_AutoKnowledge">
    <bpmndi:BPMNPlane id="BPMNPlane_AutoKnowledge" bpmnElement="automatic_knowledge_processing">
      <!-- Linear Flow - Simple Automatic Processing -->
      <bpmndi:BPMNShape id="StartEvent_FileUploaded_di" bpmnElement="StartEvent_FileUploaded">
        <dc:Bounds x="152" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="137" y="145" width="66" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="Task_ExtractText_di" bpmnElement="Task_ExtractText">
        <dc:Bounds x="240" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="Task_ChunkDocument_di" bpmnElement="Task_ChunkDocument">
        <dc:Bounds x="400" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="Task_GenerateEmbeddings_di" bpmnElement="Task_GenerateEmbeddings">
        <dc:Bounds x="560" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="Task_CreateKnowledgeAsset_di" bpmnElement="Task_CreateKnowledgeAsset">
        <dc:Bounds x="720" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="Task_StoreVectorChunks_di" bpmnElement="Task_StoreVectorChunks">
        <dc:Bounds x="880" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="Task_ActivateKnowledgeAsset_di" bpmnElement="Task_ActivateKnowledgeAsset">
        <dc:Bounds x="1040" y="80" width="100" height="80" />
        <bpmndi:BPMNLabel />
      </bpmndi:BPMNShape>
      
      <bpmndi:BPMNShape id="EndEvent_KnowledgeReady_di" bpmnElement="EndEvent_KnowledgeReady">
        <dc:Bounds x="1202" y="102" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="1186" y="145" width="68" height="27" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      
      <!-- Sequence Flow Edges -->
      <bpmndi:BPMNEdge id="Flow_ToTextExtraction_di" bpmnElement="Flow_ToTextExtraction">
        <di:waypoint x="188" y="120" />
        <di:waypoint x="240" y="120" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="Flow_ToChunking_di" bpmnElement="Flow_ToChunking">
        <di:waypoint x="340" y="120" />
        <di:waypoint x="400" y="120" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="Flow_ToEmbeddings_di" bpmnElement="Flow_ToEmbeddings">
        <di:waypoint x="500" y="120" />
        <di:waypoint x="560" y="120" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="Flow_ToKnowledgeAsset_di" bpmnElement="Flow_ToKnowledgeAsset">
        <di:waypoint x="660" y="120" />
        <di:waypoint x="720" y="120" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="Flow_ToVectorStorage_di" bpmnElement="Flow_ToVectorStorage">
        <di:waypoint x="820" y="120" />
        <di:waypoint x="880" y="120" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="Flow_ToActivation_di" bpmnElement="Flow_ToActivation">
        <di:waypoint x="980" y="120" />
        <di:waypoint x="1040" y="120" />
      </bpmndi:BPMNEdge>
      
      <bpmndi:BPMNEdge id="Flow_ToCompletion_di" bpmnElement="Flow_ToCompletion">
        <di:waypoint x="1140" y="120" />
        <di:waypoint x="1202" y="120" />
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
