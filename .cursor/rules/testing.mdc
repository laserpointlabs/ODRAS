---
alwaysApply: true
---
# ODRAS Testing Standards

## Critical Testing Context
- ODRAS tests are **INTEGRATION TESTS** that require the FULL STACK running
- Tests connect to the REAL API at http://localhost:8000
- Required services: PostgreSQL, Neo4j, Qdrant, Redis, Fuseki, ODRAS API
- Test credentials: Username: `das_service`, Password: `das_service_2024!`
- Tests will be SLOW (8+ seconds for some operations) - this is EXPECTED
- Use 30-second timeouts for HTTP clients

## Test Execution Requirements

### Pre-Merge Validation (MANDATORY)
Before any branch merge:
1. Run: `pytest tests/api/test_full_use_case.py -v -s`
2. Verify: ALL tests pass with 0 critical failures
3. Verify: Test coverage is 90%+ for new/modified code
4. BLOCK MERGE: If any critical test fails or coverage is below 90%

### Test Coverage Standards
- Minimum 90% code coverage for new/modified code
- Critical functions must have 100% coverage
- API endpoints must have comprehensive test coverage
- Integration tests required for all workflows
- Run: `pytest tests/ -v --cov=backend --cov-report=html`

### API Endpoint Testing
Every API endpoint must have tests covering:
- All HTTP methods (GET, POST, PUT, DELETE, PATCH)
- Success scenarios (200, 201, 204 responses)
- Error scenarios (400, 401, 403, 404, 422, 500 responses)
- Authentication and authorization validation
- Input validation and sanitization
- Response schema validation
- Performance requirements (response time < 2s)

### Test Organization
```
tests/
├── unit/          # Unit tests for individual components
├── api/           # API endpoint tests
├── integration/   # Integration and workflow tests
├── performance/   # Performance and load tests
└── fixtures/      # Test data and fixtures
```

### Test File Naming
- Prefix `test_` for Python test files
- Descriptive names: `test_feature_scenario_expected`
- Match source file structure in tests directory
- Use snake_case for file names

## CI/CD Requirements
- GitHub Actions must spin up the complete stack
- Tests run against real databases, not mocks
- Generate and publish test coverage reports
- Block merges if tests fail

## Do NOT
- Create unit tests with mocked dependencies unless explicitly requested
- Use ASGITransport or in-memory test clients
- Apologize for slow tests - they test the real system
- Disable or skip tests without justification

## Test Data Management
- Use isolated test data that doesn't affect production
- Clean up test data after test execution
- Use fixtures for reusable test data
- Mock external services and dependencies
- Use realistic data scenarios

## Test Update Requirements
When modifying code:
- Modify existing tests if behavior changes
- Add new tests for new functionality
- Update test data and fixtures as needed
- Update integration tests for workflow changes
- Update API validation scripts for endpoint changes
- NEVER commit code changes without updating corresponding tests
